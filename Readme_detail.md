# ZundaGPT2　追加資料

Copyright (c) 2024 led-mirage

## はじめに

この追加資料では、より詳しい情報を記載しているのだ。

- [アプリを動かすのに必要なもの](#アプリを動かすのに必要なもの)
- [設定ファイル](#設定ファイル)
- [通信先](#通信先)

## アプリを動かすのに必要なもの

### ✅ OpenAIアカウントとAPIキー

チャットの部分はOpenAIのAIを使用しているので、OpenAIのアカウントとAPIの利用登録（課金およびAPIキーの作成）が必要なのだ。

アカウントを作成すると、作ってから３ヵ月間有効な無料枠（$18）があるようなので、それを使ってもいいのだ。ボクの場合は利用開始から３ヵ月以上経ってしまっていたので、無料枠は利用できなくて、仕方ないから$10課金したのだ。

APIキーの作成は特に難しくないのだ。OpenAI APIの設定画面に入って、左側の`API Keys`というメニューから新しいAPIキーを作成すればいいのだ。作成するときに表示されるAPIキーは、作成後には２度と表示できないからメモ帳などにコピペして保存しておくといいのだ。このキーはあとから設定に必要になるのだ。

OpenAI … https://platform.openai.com/

### ✅ VOICEVOX（オプション）

ずんだもんやVOICEVOXに入っている他のキャラクターの声でチャットを読み上げてもらうには、あらかじめVOICEVOXをインストールしておく必要があるのだ。VOICEVOXは公式サイトからダウンロードして簡単にインストールできるのだ。

VOICEVOXのユーザーインターフェイスが不要な人は、VOICEVOX Engineを利用することもできるのだ。少し玄人向けなので、分からない人は素直にVOICEVOXを利用するのがお勧めなのだ。

VOICEVOX … https://voicevox.hiroshiba.jp/  
VOICEVOX Engine … https://github.com/VOICEVOX/voicevox_engine

### ✅ COEIROINK（オプション）

COEIROINKはVOICEVOXと同じ無料のテキスト読み上げソフトウェアなのだ。COEIROINKをダウンロードしてインストールしておけば、ZundaGPT2でも使えるのだ。

COEIROINK … https://coeiroink.com/

### ✅ A.I.VOICE（オプション）

A.I.VOICEで話してもらうにはA.I.VOICEを購入してインストールしておく必要があるのだ。購入方法、インストール方法などは公式ページを見て欲しいのだ。もうすでに持っている人は使ってみて欲しいのだ。

ちなみにA.I.VOICE2には対応していないので注意してなのだ。

A.I.VOICE … https://aivoice.jp/

## 設定ファイル

### ⚙️ アプリケーション設定ファイル（オプション）

`settings.json`ファイルにはこのアプリの設定情報が記載されているのだ。普通は特に変更する必要はないけど、自分用にカスタマイズしたい人は、このファイルをいじるといいのだ。以下に設定項目を簡単に紹介するのだ。

#### ✨ user/name（既定値 あなた）

あなたの名前の設定なのだ。

#### ✨ user/name_color（既定値 #007bff）

あなたの名前の色の設定なのだ。

#### ✨ user/tts_software（既定値 VOICEVOX）

あなたのメッセージのテキスト読み上げに使用するソフトウェアを選択するのだ。設定できる値は、"VOICEVOX"、"COEIROINK"、"AIVOICE"、もしくはテキストを読み上げない場合に使用する""の４つなのだ。

#### ✨ user/speaker_id（既定値 13）

あなたの声のIDなのだ。VOICEVOXの場合、"13"は青山龍星を意味しているのだ。VOICEVOXに収録されている他のキャラクターの声で話して欲しいときは、この値を変更すればいいのだ。キャラクターのIDを調べるには、[この資料](doc/voicevox_speaker_list.md)を参考にするといいのだ。

COEIROINKの場合、ここにはキャラクターのStyleIdを指定するのだ。StyleIdは[この資料](doc/coeiroink_speaker_list.md)を参考にしてほしいのだ。ただこの資料に載っているのは一部のキャラクターのみなのだ。使いたいキャラのStyleIdを調べるには、tool/coeiroink_speaker_list.pyを実行してほしいのだ。

A.I.VOICEの場合、ここにはキャラクターの名前かプリセットの名前を設定すればいいのだ。例えば、"琴葉 茜"とかを設定すればいいのだ。

#### ✨ user/speed_scale（既定値 1.2）

あなたの声の読み上げの速さの設定なのだ。VOICEVOXのデフォルトは1.0なんだけど、ボクは少し早く読み上げさせたかったので1.2としているのだ。遅くしたい場合はこの値を減らせばいいのだ。

A.I.VOICEの場合、この設定は無効なのだ。読み上げ方はA.I.VOICE Editor側のプリセットで調整して欲しいのだ。

#### ✨ user_pitch_scale（既定値 0.0）

あなたの声の高さの設定なのだ。この値を増やすと、声の高さが上がるのだ。ただ、少しの変化で大きく変わるので、0.1とか0.2とか小刻みに調整するといいのだ。

A.I.VOICEの場合、この設定は無効なのだ。読み上げ方はA.I.VOICE Editor側のプリセットで調整して欲しいのだ。

#### ✨ assistant/name（既定値 ずんだ）

チャットアシスタントの名前の設定なのだ。

#### ✨ assistant/name_color（既定値 #006400）

チャットアシスタントの名前の色の設定なのだ。

#### ✨ assistant/tts_software（既定値 VOICEVOX）

チャットアシスタントのメッセージのテキスト読み上げに使用するソフトウェアを選択するのだ。設定できる値は、"VOICEVOX"、"COEIROINK"、"AIVOICE"、もしくはテキストを読み上げない場合に使用する""の４つなのだ。

#### ✨ assistant/speaker_id（既定値 3）

チャットアシスタントの声のIDなのだ。VOICEVOXの場合、"3"はずんだもんを意味しているのだ。VOICEVOXに収録されている他のキャラクターの声で話して欲しいときは、この値を変更すればいいのだ。キャラクターのIDを調べるには、[この資料](doc/voicevox_speaker_list.md)を参考にするといいのだ。

COEIROINKの場合、ここにはキャラクターのStyleIdを指定するのだ。StyleIdは[この資料](doc/coeiroink_speaker_list.md)を参考にしてほしいのだ。ただこの資料に載っているのは一部のキャラクターのみなのだ。使いたいキャラのStyleIdを調べるには、tool/coeiroink_speaker_list.pyを実行してほしいのだ。

A.I.VOICEの場合、ここにはキャラクターの名前かプリセットの名前を設定すればいいのだ。例えば、"琴葉 茜"とかを設定すればいいのだ。

#### ✨ assistant/speed_scale（既定値 1.2）

チャットアシスタントの読み上げの速さの設定なのだ。VOICEVOXのデフォルトは1.0なんだけど、ボクは少し早く読み上げさせたかったので1.2としているのだ。遅くしたい場合はこの値を減らせばいいのだ。

A.I.VOICEの場合、この設定は無効なのだ。読み上げ方はA.I.VOICE Editor側のプリセットで調整して欲しいのだ。

#### ✨ assistant/pitch_scale（既定値 0.0）

チャットアシスタントの声の高さの設定なのだ。この値を増やすと、声の高さが上がるのだ。ただ、少しの変化で大きく変わるので、0.1とか0.2とか小刻みに調整するといいのだ。

A.I.VOICEの場合、この設定は無効なのだ。読み上げ方はA.I.VOICE Editor側のプリセットで調整して欲しいのだ。

#### ✨ chat/api（既定値 OpenAI）

使用するAPIの設定なのだ。設定できる値は`OpenAI`と`AzureOpenAI`の二つなのだ。あまり使っている人はいないかもしれないけど、Azure OpenAI ServiceのAPIを使用する場合は`AzureOpenAI`にするのだ。

`AzureOpenAI`を使う場合は、設定しないといけない環境変数が違うので注意して欲しいのだ。

| キー | 意味 |
|------|------|
| AZURE_OPENAI_ENDPOINT | Azure OpenAI Serviceの通信先（エンドポイント）|
| AZURE_OPENAI_API_KEY  | APIキー |

需要がないと思うのでAzure OpenAI Serviceの詳しい説明は省略するのだ。使いたい人は自分で調べて欲しいのだ。

#### ✨ chat/model（既定値 gpt-3.5-turbo-0125）

OpenAIのテキスト生成のモデル名を指定するのだ。これを変更することでAIの賢さが変わるのだ。既定はリーズナブルなGTP3.5を使用しているのだ。もっと賢くしたい場合はGPT4.0系も使えるけれど、その分利用量が上がるので注意するのだ。使用できるモデルの一覧と利用料金は以下のリンクで確認できるのだ。

モデルの一覧 … https://platform.openai.com/docs/models  
利用料金 … https://openai.com/pricing#language-models

#### ✨ chat/instraction（既定値 君は優秀なアシスタント…以下略）

AIのキャラづけの設定なのだ。ここで、AIの台詞をずんだもんっぽくするようお願いしているのだ。ここを変更することで、ずんだもん以外のキャラクターっぽい回答を生成することも可能なのだ。

#### ✨ chat/bad_response（既定値 答えられないのだ）

何らかの原因でAIが回答できなかった場合に表示するセリフを設定するのだ。無理なお願いをするとAIが答えてくれない場合があるから気を付けるといいのだ。

#### ✨ chat/history_size（既定値 6）

AIに送信する過去の会話の履歴数を設定するのだ。この値が大きいほど前の回答、質問を考慮した回答をAIが生成するようになって、会話のつながりがよくなるのだ。ただ、その分利用料金も増えるので注意が必要なのだ。

この設定がある理由を考えればわかるけど、OpenAIのAIは過去の会話を覚えていないのだ。質問をするたびに、過去の会話もAIに送信することで、AIは会話のつながりを知ることができるのだ。ただ利用料金は送信するデータ量が増えるとその分加算されるので、バランスをとることが大事なのだ。

#### ✨ tts/voicevox_server（既定値 http://127.0.0.1:50021）

VOICEVOXのサーバーのURLを記載するのだ。これがVOICEVOXのデフォルトなので、普通はここを変更する必要はないのだ。分かる人はわかると思うんだけど、このIPは自PCのIPになっているのだ。他のPCで実行しているVOICEVOXに声を生成してもらう場合は、このURLを変更すればいいのだ。ただ、ファイアウォールの設定とかいろいろ面倒なので、分からない人は気にする必要はないのだ。

#### ✨ tts/voicevox_path（既定値 %LOCALAPPDATA%/Programs/VOICEVOX/VOICEVOX.exe）

VOICEVOXの実行ファイルのパスを記載するのだ。この項目がない場合は、VOICEVOXのWindowsへの既定のインストール先が使われるのだ。

#### ✨ tts/coeiroink_server（既定値 http://127.0.0.1:50032）

VOICEVOXのサーバーのURLを記載するのだ。これがVOICEVOXのデフォルトなので、普通はここを変更する必要はないのだ。分かる人はわかると思うんだけど、このIPは自PCのIPになっているのだ。他のPCで実行しているVOICEVOXに声を生成してもらう場合は、このURLを変更すればいいのだ。ただ、ファイアウォールの設定とかいろいろ面倒なので、分からない人は気にする必要はないのだ。

#### ✨ coeiroink_path（既定値 空文字）

COEIROINKの実行ファイルのパスを記載するのだ。COEIROINKは既定のインストール場所がないから、自分がインストールした場所（解凍した場所）を記載するのだ。例えば次のように記載するのだ。

```json
"coeiroink_path": "C:/Program Files/COEIROINK_GPU/COEIROINKv2.exe"
```

なんのことかわからない人は、COEIROINKを起動してから、ずんだGPTを使えば問題ないのだ。

#### ✨ tts/aivoice_path（既定値 %ProgramW6432%/AI/AIVoice/AIVoiceEditor/AI.Talk.Editor.Api.dll）

A.I.VOICEのDLLのパスを記載するのだ。この項目がない場合は、A.I.VOICEの既定のインストール先の設定が使われるのだ。

#### ✨ system/log_folder（既定値 log）

チャットのログファイルを保存するフォルダを指定するのだ。この値が空文字の場合はログは保存されないのだ。

## 通信先

このアプリの通信先は以下の通りなのだ。

### 🌐 OpenAI API（HTTPS）

チャットの回答を取得するためにOpenAIのサーバーと通信を行っているのだ。通信方法は、OpenAIのライブラリを使用しているのだ。

### 🌐 Azure OpenAI Service（HTTPS）

chat/apiに`AzureOpenAI`を指定した場合は、チャットの回答を取得するために Microsoft Azure OpenAI Serviceと通信を行うのだ。通信方法は、OpenAIのライブラリを使用しているのだ。

### ➰ VOICEVOX ローカルサーバー（HTTP）

テキストを音声データに変換するために、VOICEVOXのローカルサーバーと通信を行っているのだ。既定のエンドポイントは `http://127.0.0.1:50021` なのだ。

### ➰ COEIROINK ローカルサーバー（HTTP）

テキストを音声データに変換するために、VOICEVOXのローカルサーバーと通信を行っているのだ。既定のエンドポイントは `http://127.0.0.1:50032` なのだ。

### ➰ A.I.VOICE API

テキストを音声データに変換するために、A.I.VOICE Editor APIを使用しているのだ。通信方法は明記されていないけど、名前付きパイプかなにかを使っているんじゃないかな（てきとー）。

### ➰ pywebview（TCP）

このアプリではGUIをpywebviewで作ってるんだけど、UI(HTML)とバックエンドのPythonプログラムとの連携をとるのにTCPでリスニングしているみたい。詳しいことはわからないのだ。

## ファイル入出力

### 🗒️ 設定ファイル（settings.json）

アプリの設定を記載したファイル。初回起動時に自動的に作成されるのだ。

### 🗒️ チャットログファイル（chatlog-yyyymmdd-hhmmss.json）

チャットの内容を記載したファイル。ファイル名の日時はチャットを開始した日時なのだ。

